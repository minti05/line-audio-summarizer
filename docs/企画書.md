> [!IMPORTANT]
> **AIアシスタントへの指示**:
> 開発を進める際は、まず \`docs/要件定義.md\` と \`docs/開発フロー.md\` を読み込み、プロジェクトの全容と現在の進捗ステップを把握してください。
> 各ドキュメント（企画書、要件定義、UX設計、サービス検討、開発フロー）は互いに整合性が取れるように運用してください。仕様の変更を独断で行わず、必ず提案と確認を経てから実行してください。
> 🛑 マークがある箇所は、人間の操作や確認が必要なタイミングです。必ず作業を中断し、ユーザーに指示を仰いでください。

# LINE audiomemo 企画書 (仮)

## 1. サービス概要
### コンセプト
「話すだけで、明日への資産が積み上がる」
音声入力を起点に、AIが日々の思考・感情・TODOを整理し、指定したプラットフォームへ自動連携するジャーナリング・オートメーションツール。

### ターゲットユーザー
- 思考の壁打ちや日記を習慣化したいが、タイピングが面倒な人
- 外出中や移動中にアイデアをキャッチアップしたい人
- 複数のプラットフォーム（Obsidianや、n8n等を通じてSlack/Notion/カレンダー等）へ情報を流したい人

## 2. ユーザーフロー
1. **入力**: LINE公式アカウントに音声メッセージまたは音声ファイルを送信。
2. **解析**: Gemini 1.5 Flashが音声を直接読み取り、ユーザー設定のプロンプトに基づき構造化テキスト（文字起こし＋要約）を生成。
3. **確認（初期設定）**: AIが作成した要約をLINE上で確認し、「承認（送信）」または「キャンセル」を選択。
4. **配信**: 承認された内容を、連携済みのプラットフォーム（Obsidian, Slack等）へ送信。

## 3. 主要機能
### 音声解析・要約（Gemini 1.5 Flash）
- **マルチモーダル解析**: 音声ファイルを直接入力し、文字起こしと要約を実行（データ容量節約のため、保存は要約結果のみ）。
- **感情・ニュアンスの抽出**: 音声のトーンから「話者の感情」や「状況」を読み取ったジャーナリング。
- **カスタムプロンプト / プリセット**: 
    - **4つの基本モード**:
        1. **日記モード**: 出来事と感情を整理し、共感的なトーンで記録。
        2. **TODO抽出モード**: アクションアイテムを抽出し、チェックリスト化。
        3. **気づき・メモモード**: 断片的なアイデアやつぶやきを簡潔に記録。
        4. **アイデア壁打ちモード**: 思考を構造化し、さらに深めるための「問い」や「視点」をAIが提案。
    - **フルカスタム**: `/prompt` コマンドで、ユーザー自身が定義した指示(System Prompt)を適用可能。
- **事前確認モード**: 配信前に要約内容を確認し、送信するかキャンセルするかを選択できる機能。
- **配信自動化設定**: 慣れてきたユーザー向けに、確認なしで即座に配信するモードへの切り替え。

### 外部連携
- **Obsidian連携**:
    - デイリーノートへの自動追記機能（既存のノートに追記）。
    - 独立したメモとしての保存機能（ファイル名テンプレートやフォルダ自動振り分け対応）。
    - 起動時自動同期および定期同期（同期間隔設定可能）。
- **Webhook / iPaaS 連携**: 
    - n8n, Make, Zapier 等の Webhook URL へ要約結果を送信。
    - ユーザー側でワークフローを組むことで、Slack, Notion, Googleカレンダー等あらゆるサービスへ自動連携が可能。

## 4. 技術アーキテクチャ
### システム構成
- **フロントエンド**: LINE (Messaging API)
- **バックエンド**: Cloudflare Workers
- **DB/ストレージ**: Cloudflare Workers KV & D1
- **外部サービス連携**: LINE API, Slack API, Google Gemini 1.5 Flash

### セキュリティ（Obsidian連携）
- **エンドツーエンド暗号化**:
    - サーバー側（KV）では、ユーザーの公開鍵で暗号化された状態で保存。
    - ユーザーのデバイス（Obsidianプラグイン）でのみ復号可能。
- **認証**: LINE Webhookの署名検証、Vault IDとUser IDのマッピング。

## 5. フェーズ別ロードマップ
### Phase 1: MVP (Minimum Viable Product)
- LINE送受信 → Gemini 1.5 Flash による音声直接解析（文字起こし＋要約） → LINEに返却。
- **要約の事前確認・送信/キャンセルロジックの実装**。
- Cloudflare Workers + KV による基本的なメッセージ管理の実装。
- Obsidianプラグイン（手動同期）の開発。

### Phase 2: 連携強化
- Slack とのOAuth連携機能の実装（トークン管理基盤の構築）。
- Obsidianプラグインの高度化（フォルダ振り分け、テンプレート設定、起動時同期オプション）。
- カスタムプロンプト機能のUI実装。

### Phase 3: 高度化
- 過去のジャーナルに基づいたAIからの「問いかけ」機能。
- Web版管理画面の提供。
